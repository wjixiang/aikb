// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Main citation model - represents a MedlineCitation
model MedlineCitation {
  pmid           Int       @id
  dateCompleted  DateTime?
  dateRevised    DateTime
  citationSubset String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  article            Article?
  medlineJournalInfo MedlineJournalInfo?
  chemicals          Chemical[]
  meshHeadings       MeshHeading[]
  pubmedData         PubMedData?

  @@index([dateCompleted])
  @@index([dateRevised])
  @@map("medline_citations")
}

// Article information
model Article {
  id               Int      @id @default(autoincrement())
  pmid             Int      @unique
  journal          Json // Stores Journal info as JSON
  articleTitle     String   @db.Text
  pagination       Json? // Stores MedlinePgn
  language         String?
  publicationTypes Json // Stores PublicationType array
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  medlineCitation MedlineCitation @relation(fields: [pmid], references: [pmid], onDelete: Cascade)
  authors         Author[]
  grants          Grant[]

  @@index([pmid])
  @@map("articles")
}

// Author information
model Author {
  id          Int      @id @default(autoincrement())
  articleId   Int
  lastName    String?
  foreName    String?
  initials    String?
  affiliation String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
  @@map("authors")
}

// Grant information
model Grant {
  id        Int      @id @default(autoincrement())
  articleId Int
  grantId   String?
  acronym   String?
  agency    String?
  country   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
  @@map("grants")
}

model Journal {
  id                  Int                  @id @default(autoincrement())
  country             String?
  medlineTA           String
  nlmUniqueId         Int                  @unique
  issnLinking         String?
  medlineJournalInfos MedlineJournalInfo[]
}

// Medline Journal Info
model MedlineJournalInfo {
  id        Int      @id @default(autoincrement())
  pmid      Int      @unique
  journal   Journal  @relation(fields: [journalId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  medlineCitation MedlineCitation @relation(fields: [pmid], references: [pmid], onDelete: Cascade)
  journalId       Int

  @@index([pmid])
  @@map("medline_journal_info")
}

// Chemical information
model Chemical {
  id              Int      @id @default(autoincrement())
  pmid            Int
  registryNumber  String
  nameOfSubstance String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  medlineCitation MedlineCitation @relation(fields: [pmid], references: [pmid], onDelete: Cascade)

  @@index([pmid])
  @@index([registryNumber])
  @@map("chemicals")
}

// MeSH Heading
model MeshHeading {
  id             Int      @id @default(autoincrement())
  pmid           Int
  descriptorName String
  qualifierNames Json // Stores array of qualifier names
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  medlineCitation MedlineCitation @relation(fields: [pmid], references: [pmid], onDelete: Cascade)

  @@index([pmid])
  @@index([descriptorName])
  @@map("mesh_headings")
}

// PubMed Data
model PubMedData {
  id                Int      @id @default(autoincrement())
  pmid              Int      @unique
  publicationStatus String?
  articleIds        Json // Stores ArticleId array
  history           Json // Stores PubMedPubDate array
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  medlineCitation MedlineCitation @relation(fields: [pmid], references: [pmid], onDelete: Cascade)

  @@index([pmid])
  @@map("pubmed_data")
}

// Sync tracking for baseline files
model BaselineSync {
  id           Int      @id @default(autoincrement())
  fileName     String   @unique
  fileDate     String
  recordsCount Int
  syncedAt     DateTime @default(now())
  status       String   @default("completed") // completed, failed, in_progress
  errorMessage String?  @db.Text
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([fileDate])
  @@index([status])
  @@map("baseline_syncs")
}
