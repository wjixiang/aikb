generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Main entity table
model Entity {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Abstract fields merged into Entity
  description String
  
  // One-to-many relationship with nomenclatures
  nomenclatures Nomenclature[]
  
  // One-to-one relationship with embedding
  embedding Embedding?

  // Indexes for search and retrieval
  @@index([description])
  @@map("entities")
}

// Nomenclature table for entity names in different languages
model Nomenclature {
  id        String   @id @default(cuid())
  entityId  String
  name      String
  acronym   String?
  language  String   // 'en' | 'zh' without enum restriction
  
  // Many-to-one relationship with entity
  entity Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  
  // Indexes for search
  @@index([entityId])
  @@index([name])
  @@index([language])
  @@map("nomenclatures")
}

// Embedding table for vector storage
model Embedding {
  id        String   @id @default(cuid())
  entityId  String   @unique
  
  // Embedding configuration (without enum restrictions)
  model     String   // EmbeddingModel
  dimension Int
  batchSize Int
  maxRetries Int
  timeout   Int
  provider  String   // EmbeddingProvider
  
  // Vector data stored as array
  vector    Unsupported("vector")?
  
  // One-to-one relationship with entity
  entity Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  
  // Note: Removed btree index on vector as it exceeds PostgreSQL's index size limit
  // For vector similarity search, use pgvector's HNSW or IVFFlat indexes instead:
  // CREATE INDEX embedding_vector_hnsw_idx ON embeddings USING hnsw (vector vector_cosine_ops);
  // Or run the migration manually after database setup
  @@map("embeddings")
}
