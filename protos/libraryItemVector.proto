syntax = "proto3";

package libraryItemVector;

// Library Item Vector service definition
service LibraryItemVectorService {
  // Create a new chunk embedding group
  rpc CreateChunkEmbedGroup(CreateChunkEmbedGroupRequest) returns (CreateChunkEmbedGroupResponse);
  rpc ListChunkEmbedGroupMetadata(ListItemChunkEmbedGroupMetadataRequest) returns (ListItemChunkEmbedGroupMetadataResponse);
  rpc EmbedChunks(EmbedChunksRequest) returns (EmbedChunksResponse);
  rpc SemanticSearchByItemidAndGroupid(SemanticSearchByItemidAndGroupidRequest) returns (SemanticSearchByItemidAndGroupidResponse);
}

// Chunking configuration
message ChunkingConfig {
  string strategy = 1; // e.g., 'h1', 'paragraph', 'semantic'
  map<string, string> parameters = 2; // Strategy-specific parameters
}

// Embedding configuration
message EmbeddingConfig {
  string provider = 1; // e.g., 'openai', 'cohere', 'local'
  string model = 2; // e.g., 'text-embedding-ada-002'
  int32 dimension = 3; // Vector dimension
  map<string, string> parameters = 4; // Provider-specific parameters
}

// Request to create a new chunk embedding group
message CreateChunkEmbedGroupRequest {
  string name = 1;
  string description = 2;
  ChunkingConfig chunking_config = 3;
  EmbeddingConfig embedding_config = 4;
  bool is_default = 5;
  bool is_active = 6;
  string created_by = 7;
  repeated string tags = 8;
  string item_id = 9;
}

// Response containing the created chunk embedding group
message CreateChunkEmbedGroupResponse {
  ChunkEmbedGroupMetadata group = 1;
}

// Chunk embedding group metadata
message ChunkEmbedGroupMetadata {
  string id = 1;
  string item_id = 2;
  string name = 3;
  string description = 5;
  ChunkingConfig chunking_config = 6;
  EmbeddingConfig embedding_config = 7;
  bool is_default = 8;
  bool is_active = 9;
  int64 created_at = 10;
  int64 updated_at = 11;
  string created_by = 12;
  repeated string tags = 13;
}

message ListItemChunkEmbedGroupMetadataRequest {
  string item_id = 1; // ID of target item
  int32 page_size = 2; // Pagination
  string page_token = 3;
  string filter = 4;
  string order_by = 5;
}

message ListItemChunkEmbedGroupMetadataResponse {
  repeated ChunkEmbedGroupMetadata groups = 1;  
  string next_page_token = 2;                   
  int32 total_size = 3;                         
}

message EmbedChunksRequest {
  string chunk_embed_group_id = 1;
  repeated ChunkData chunks = 2;
}

message ChunkData {
  string item_id = 1;
  string title = 2;
  string content = 3;
  int32 index = 4;
  map<string, string> metadata = 5;
}

message EmbedChunksResponse {
  bool success = 1;
  string message = 2;
  repeated string chunk_ids = 3;
}

message SemanticSearchByItemidAndGroupidRequest {
  string item_id = 1;
  string chunk_embed_group_id = 2;
  string query = 3;
  int32 top_k = 4;
  float score_threshold = 5;
  map<string, string> filter = 6;
}

message SemanticSearchByItemidAndGroupidResponse {
  bool success = 1;
  string message = 2;
  repeated SemanticSearchResult results = 3;
}

message SemanticSearchResult {
  string chunk_id = 1;
  string item_id = 2;
  string title = 3;
  string content = 4;
  float score = 5;
  map<string, string> metadata = 6;
}